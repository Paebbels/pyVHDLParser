language: python

install:
  - pip3 install -U -r requirements.txt
  - pip3 install -U Coverage
  - pip3 install -U codacy-coverage

# if: tag IS present

before_script:
  - export CODACY_PROJECT_TOKEN=$CODACY_TOKEN

script:
  - coverage run --append tests.unit.Tokens
  - coverage run --append tests.unit.Entity
  - coverage run --append tests.unit.Architecture
  - coverage report
  - coverage xml
  - python-codacy-coverage -r coverage.xml
  - python -m unittest tests.unit.Entity

deploy:
  provider: pypi
  user: "__token__"
  password: $PYPI_TOKEN
  distributions: "sdist bdist_wheel"
  skip_existing: true
  on:
    tags: true
